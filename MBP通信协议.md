# MBP通信协议

**该文档中所有讯息均为json串**

**所有服务端下发请求和端站应答均应当包含request_id字段（uuid），用于实现请求和响应的一一匹配，下文中所有消息省略该字段，不做重复说明**

### 端站数据与控制

#### 1、查询工作模式

服务端下发请求：

| 字段     | 内容示例       | 备注                   |
| -------- | -------------- | ---------------------- |
| "sn"     | "SN000001"     | 设备序列号             |
| "op"     | "query"        | 操作类型：查询         |
| "op_sub" | "work_pattern" | 操作子类：查询工作模式 |

端站应答：

| 字段      | 内容示例       | 备注                     |
| --------- | -------------- | ------------------------ |
| "sn"      | "SN000001"     | 设备序列号               |
| "op"      | "query_ans"    | 操作类型：查询（响应）   |
| "op_sub"  | "work_pattern" | 操作子类：查询工作模式   |
| "pattern" | "0"            | 0：自动模式，1：手动模式 |

#### 2、设置工作模式

服务端下发请求：

| 字段      | 内容示例          | 备注                       |
| --------- | ----------------- | -------------------------- |
| "sn"      | "SN000001"        | 设备序列号                 |
| "op"      | "antenna_control" | 操作类型：天线控制         |
| "op_sub"  | "work_pattern"    | 操作子类：设置天线工作模式 |
| "pattern" | "0"               | 0：自动模式，1：手动模式   |

端站应答：

| 字段     | 内容示例              | 备注                       |
| -------- | --------------------- | -------------------------- |
| "sn"     | "SN000001"            | 设备序列号                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应） |
| "op_sub" | "work_pattern"        | 操作子类：设置天线工作模式 |
| "result" | "1"                   | 1：操作成功，0：操作失败   |

#### 3、查询设备状态

服务端下发请求：

| 字段     | 内容示例           | 备注                   |
| -------- | ------------------ | ---------------------- |
| "sn"     | "SN000001"         | 设备序列号             |
| "op"     | "query"            | 操作类型：查询         |
| "op_sub" | "equipment_status" | 操作子类：查询设备状态 |

端站应答：

| 字段              | 内容示例           | 备注                         |
| ----------------- | ------------------ | ---------------------------- |
| "sn"              | "SN000001"         | 设备序列号                   |
| "op"              | "query_ans"        | 操作类型：查询（响应）       |
| "op_sub"          | "equipment_status" | 操作子类：查询设备状态       |
| "IMU_stat"        | "1"                | 1：正常，0：异常             |
| "DGPS_stat"       | "1"                | 1：正常，0：异常             |
| "storage_stat"    | "1"                | 1：正常，0：异常             |
| "yaw_moto_stat"   | "1"                | 1：正常，0：异常             |
| "pitch_moto_stat" | "1"                | 1：正常，0：异常             |
| "yaw_lim_stat"    | "1"                | 1：正常，0：异常（到达限位） |
| "pitch_lim_stat"  | "1"                | 1：正常，0：异常（到达限位） |

#### 4、手动控制天线

服务端下发请求：

| 字段     | 内容示例          | 备注                                   |
| -------- | ----------------- | -------------------------------------- |
| "sn"     | "SN000001"        | 设备序列号                             |
| "op"     | "antenna_control" | 操作类型：天线控制                     |
| "op_sub" | "rotate"          | 操作子类：控制天线旋转                 |
| "mode"   | "0"               | 0：增量模式，1：绝对值模式             |
| "axis"   | "0"               | 与direct联动，确定旋转方向，具体见附表 |
| "direct" | "0"               | 与axis联动，确定旋转方向，具体见附表   |
| "angle"  | "1.1"             | 旋转角度                               |

端站应答：

| 字段     | 内容示例              | 备注                                       |
| -------- | --------------------- | ------------------------------------------ |
| "sn"     | "SN000001"            | 设备序列号                                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应）                 |
| "op_sub" | "rotate"              | 操作子类：控制天线旋转                     |
| "result" | "1"                   | 1：操作成功，0：操作失败                   |
| "error"  | ""                    | 操作成功时为空，失败时为失败原因或报错内容 |

附表——axis, direct与按键对应关系：

| axis取值 | direct取值 | 对应网页按键 |
| -------- | ---------- | ------------ |
| 0        | 0          | 右           |
| 0        | 1          | 左           |
| 1        | 0          | 上           |
| 1        | 1          | 下           |



### 端站系统管理

#### 1、查询工作模式

与“端站数据与控制”完全相同

#### 2、查询工作模式

与“端站数据与控制”完全相同

#### 3、系统复位

服务端下发请求：

| 字段     | 内容示例          | 备注                                                         |
| -------- | ----------------- | ------------------------------------------------------------ |
| "sn"     | "SN000001"        | 设备序列号                                                   |
| "op"     | "antenna_control" | 操作类型：天线控制                                           |
| "op_sub" | "adu_soft_rst"    | 操作子类：ADU软件复位(adu_soft_rst), <br />ADU业务复位(adu_task_rst) |

端站响应：

| 字段     | 内容示例              | 备注                                                         |
| -------- | --------------------- | ------------------------------------------------------------ |
| "sn"     | "SN000001"            | 设备序列号                                                   |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应）                                   |
| "op_sub" | "adu_soft_rst"        | 操作子类：ADU软件复位(adu_soft_rst), <br />ADU业务复位(adu_task_rst) |
| "result" | "1"                   | 1：执行成功，0：执行失败                                     |

#### 4、查询RTC时间

服务端下发请求：

| 字段     | 内容示例   | 备注                  |
| -------- | ---------- | --------------------- |
| "sn"     | "SN000001" | 设备序列号            |
| "op"     | "query"    | 操作类型：查询        |
| "op_sub" | "RTC"      | 操作子类：查询RTC配置 |

端站响应：

| 字段     | 内容示例     | 备注                   |
| -------- | ------------ | ---------------------- |
| "sn"     | "SN000001"   | 设备序列号             |
| "op"     | "query_ans"  | 操作类型：查询（响应） |
| "op_sub" | "RTC"        | 操作子类：查询RTC配置  |
| "date"   | "2025-08-08" | 日期                   |
| "time"   | "12:08:53"   | 时间                   |

#### 5、设置RTC时间

服务端下发请求：

| 字段     | 内容示例          | 备注                  |
| -------- | ----------------- | --------------------- |
| "sn"     | "SN000001"        | 设备序列号            |
| "op"     | "antenna_control" | 操作类型：天线控制    |
| "op_sub" | "set_RTC"         | 操作子类：设置RTC时间 |
| "date"   | "2025-08-08"      | 日期                  |
| "time"   | "12:08:53"        | 时间                  |

端站应答：

| 字段     | 内容示例              | 备注                       |
| -------- | --------------------- | -------------------------- |
| "sn"     | "SN000001"            | 设备序列号                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应） |
| "op_sub" | "set_RTC"             | 操作子类：设置RTC时间      |
| "result" | "1"                   | 1：操作成功，0：操作失败   |

#### 6、上报参数查询

服务端下发请求：

| 字段     | 内容示例        | 备注                   |
| -------- | --------------- | ---------------------- |
| "sn"     | "SN000001"      | 设备序列号             |
| "op"     | "query"         | 操作类型：查询         |
| "op_sub" | "report_config" | 操作子类：查询上报参数 |

端站响应：

| 字段       | 内容示例        | 备注                                     |
| ---------- | --------------- | ---------------------------------------- |
| "sn"       | "SN000001"      | 设备序列号                               |
| "op"       | "query_ans"     | 操作类型：查询（响应）                   |
| "op_sub"   | "report_config" | 操作子类：查询上报参数                   |
| "mode"     | "1"             | 0：不上报，1：通过CPE上报，2：通过NB上报 |
| "interval" | "60.0"          | 上报间隔时间，单位为秒                   |

*注：这里端站响应实际上还包含两个隐藏字段，即ip和port

#### 7、上报参数设置

服务端下发请求：

| 字段       | 内容示例            | 备注                                     |
| ---------- | ------------------- | ---------------------------------------- |
| "sn"       | "SN000001"          | 设备序列号                               |
| "op"       | "antenna_control"   | 操作类型：天线控制                       |
| "op_sub"   | "set_report_config" | 操作子类：设置上报参数                   |
| "ip"       | "101.90.22.16"      | 设置端站上报的ip地址                     |
| "port"     | "11789"             | 设置端站上报的端口                       |
| "mode"     | "1"                 | 0：不上报，1：通过CPE上报，2：通过NB上报 |
| "interval" | "60.0"              | 上报间隔时间，单位为秒                   |

端站应答：

| 字段     | 内容示例              | 备注                       |
| -------- | --------------------- | -------------------------- |
| "sn"     | "SN000001"            | 设备序列号                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应） |
| "op_sub" | "set_report_config"   | 操作子类：设置上报参数     |
| "result" | "1"                   | 1：操作成功，0：操作失败   |

#### 8、版本查询

服务端下发请求：

| 字段     | 内容示例   | 备注                     |
| -------- | ---------- | ------------------------ |
| "sn"     | "SN000001" | 设备序列号               |
| "op"     | "query"    | 操作类型：查询           |
| "op_sub" | "version"  | 操作子类：查询软硬件版本 |

端站响应：

| 字段           | 内容示例    | 备注                     |
| -------------- | ----------- | ------------------------ |
| "sn"           | "SN000001"  | 设备序列号               |
| "op"           | "query_ans" | 操作类型：查询（响应）   |
| "op_sub"       | "version"   | 操作子类：查询软硬件版本 |
| "model"        | "MBP N28"   | 产品型号                 |
| "hw_version"   | "1.0"       | 硬件版本                 |
| "ADU_version"  | "1.0"       | ADU软件版本              |
| "ACU_version"  | "1.0"       | ACU软件版本              |
| "stru_version" | "1.0"       | 结构版本                 |

