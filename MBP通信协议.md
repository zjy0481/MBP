# MBP通信协议

**该文档中所有讯息均为json串**

### 端站数据与控制

#### 1、查询工作模式

服务端下发请求：

| 字段     | 内容示例       | 备注                   |
| -------- | -------------- | ---------------------- |
| "sn"     | "SN000001"     | 设备序列号             |
| "op"     | "query"        | 操作类型：查询         |
| "op_sub" | "work_pattern" | 操作子类：查询工作模式 |

端站应答：

| 字段      | 内容示例       | 备注                     |
| --------- | -------------- | ------------------------ |
| "sn"      | "SN000001"     | 设备序列号               |
| "op"      | "query_ans"    | 操作类型：查询（响应）   |
| "op_sub"  | "work_pattern" | 操作子类：查询工作模式   |
| "pattern" | "0"            | 0：自动模式，1：手动模式 |

#### 2、设置工作模式

服务端下发请求：

| 字段      | 内容示例          | 备注                       |
| --------- | ----------------- | -------------------------- |
| "sn"      | "SN000001"        | 设备序列号                 |
| "op"      | "antenna_control" | 操作类型：天线控制         |
| "op_sub"  | "work_pattern"    | 操作子类：设置天线工作模式 |
| "pattern" | "0"               | 0：自动模式，1：手动模式   |

端站应答：

| 字段     | 内容示例              | 备注                       |
| -------- | --------------------- | -------------------------- |
| "sn"     | "SN000001"            | 设备序列号                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应） |
| "op_sub" | "work_pattern"        | 操作子类：设置天线工作模式 |
| "result" | "1"                   | 1：操作成功，2：操作失败   |

#### 3、查询设备状态

服务端下发请求：

| 字段     | 内容示例           | 备注                   |
| -------- | ------------------ | ---------------------- |
| "sn"     | "SN000001"         | 设备序列号             |
| "op"     | "query"            | 操作类型：查询         |
| "op_sub" | "equipment_status" | 操作子类：查询设备状态 |

端站应答：

| 字段              | 内容示例           | 备注                         |
| ----------------- | ------------------ | ---------------------------- |
| "sn"              | "SN000001"         | 设备序列号                   |
| "op"              | "query_ans"        | 操作类型：查询（响应）       |
| "op_sub"          | "equipment_status" | 操作子类：查询设备状态       |
| "IMU_stat"        | "1"                | 1：正常，0：异常             |
| "DGPS_stat"       | "1"                | 1：正常，0：异常             |
| "storage_stat"    | "1"                | 1：正常，0：异常             |
| "yaw_moto_stat"   | "1"                | 1：正常，0：异常             |
| "pitch_moto_stat" | "1"                | 1：正常，0：异常             |
| "yaw_lim_stat"    | "1"                | 1：正常，0：异常（到达限位） |
| "pitch_lim_stat"  | "1"                | 1：正常，0：异常（到达限位） |

#### 4、手动控制天线

服务端下发请求：

| 字段     | 内容示例          | 备注                                   |
| -------- | ----------------- | -------------------------------------- |
| "sn"     | "SN000001"        | 设备序列号                             |
| "op"     | "antenna_control" | 操作类型：天线控制                     |
| "op_sub" | "rotate"          | 操作子类：控制天线旋转                 |
| "mode"   | "0"               | 0：增量模式，1：绝对值模式             |
| "axis"   | "0"               | 与direct联动，确定旋转方向，具体见附表 |
| "direct" | "0"               | 与axis联动，确定旋转方向，具体见附表   |
| "angle"  | "1.1"             | 旋转角度                               |

端站应答：

| 字段     | 内容示例              | 备注                                       |
| -------- | --------------------- | ------------------------------------------ |
| "sn"     | "SN000001"            | 设备序列号                                 |
| "op"     | "antenna_control_ans" | 操作类型：天线控制（响应）                 |
| "op_sub" | "rotate"              | 操作子类：控制天线旋转                     |
| "result" | "1"                   | 1：操作成功，0：操作失败                   |
| "error"  | ""                    | 操作成功时为空，失败时为失败原因或报错内容 |

附表——axis, direct与按键对应关系：

| axis取值 | direct取值 | 对应网页按键 |
| -------- | ---------- | ------------ |
| 0        | 0          | 右           |
| 0        | 1          | 左           |
| 1        | 0          | 上           |
| 1        | 1          | 下           |

