{% extends '_base_interactive_page.html' %}
{% load static %}

{% block page_title %}端站数据与状态{% endblock %}

{% block terminal_info_extra %}
<div class="col-md-6"><p class="mb-1"><strong>最近上报时间:</strong> <span id="selected_last_report">--</span></p></div>
{% endblock %}

{% block interactive_content %}
<style>
    /* 美化的状态指示灯样式 */
    .statusLight {
        width: 18px;
        height: 18px;
        border: none;
        background-color: #e9ecef;
        border-radius: 50%;
        margin: 0 auto;
        display: block;
        position: relative;
        transition: all 0.3s ease;
        box-shadow: 
            0 2px 4px rgba(0, 0, 0, 0.1),
            inset 0 1px 2px rgba(255, 255, 255, 0.8),
            inset 0 -1px 2px rgba(0, 0, 0, 0.1);
    }
    
    /* 默认状态 - 灰色 */
    .statusLight::before {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        right: 2px;
        bottom: 2px;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.2));
        border-radius: 50%;
        pointer-events: none;
    }
    
    /* 活跃状态 - 绿色 */
    .statusLight.active {
        background: linear-gradient(145deg, #28a745, #20c997);
        box-shadow: 
            0 0 15px rgba(40, 167, 69, 0.6),
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 2px rgba(255, 255, 255, 0.3);
        animation: pulse-green 2s infinite;
    }
    
    /* 错误状态 - 红色 */
    .statusLight.error {
        background: linear-gradient(145deg, #dc3545, #e74c3c);
        box-shadow: 
            0 0 15px rgba(220, 53, 69, 0.6),
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 2px rgba(255, 255, 255, 0.3);
        animation: pulse-red 2s infinite;
    }
    
    /* 警告状态 - 橙色 */
    .statusLight.warning {
        background: linear-gradient(145deg, #fd7e14, #f39c12);
        box-shadow: 
            0 0 15px rgba(253, 126, 20, 0.6),
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 2px rgba(255, 255, 255, 0.3);
        animation: pulse-orange 2s infinite;
    }
    
    /* 信息状态 - 蓝色 */
    .statusLight.info {
        background: linear-gradient(145deg, #17a2b8, #3498db);
        box-shadow: 
            0 0 15px rgba(23, 162, 184, 0.6),
            0 2px 8px rgba(0, 0, 0, 0.2),
            inset 0 1px 2px rgba(255, 255, 255, 0.3);
        animation: pulse-blue 2s infinite;
    }
    
    /* 动画效果 */
    @keyframes pulse-green {
        0%, 100% { 
            box-shadow: 
                0 0 15px rgba(40, 167, 69, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
        }
        50% { 
            box-shadow: 
                0 0 25px rgba(40, 167, 69, 0.9),
                0 2px 12px rgba(0, 0, 0, 0.3);
        }
    }
    
    @keyframes pulse-red {
        0%, 100% { 
            box-shadow: 
                0 0 15px rgba(220, 53, 69, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
        }
        50% { 
            box-shadow: 
                0 0 25px rgba(220, 53, 69, 0.9),
                0 2px 12px rgba(0, 0, 0, 0.3);
        }
    }
    
    @keyframes pulse-orange {
        0%, 100% { 
            box-shadow: 
                0 0 15px rgba(253, 126, 20, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
        }
        50% { 
            box-shadow: 
                0 0 25px rgba(253, 126, 20, 0.9),
                0 2px 12px rgba(0, 0, 0, 0.3);
        }
    }
    
    @keyframes pulse-blue {
        0%, 100% { 
            box-shadow: 
                0 0 15px rgba(23, 162, 184, 0.6),
                0 2px 8px rgba(0, 0, 0, 0.2);
        }
        50% { 
            box-shadow: 
                0 0 25px rgba(23, 162, 184, 0.9),
                0 2px 12px rgba(0, 0, 0, 0.3);
        }
    }
    
    /* 为表单标签设置固定宽度，使分隔处对齐 */
    .input-group-text {
        min-width: 150px;
        text-align: right;
        padding-right: 15px;
    }
    
    /* 表格增强样式 */
    .table th {
        background-color: #f8f9fa;
        font-weight: 600;
        border-bottom: 2px solid #dee2e6;
    }
    
    .table-bordered {
        border: 1px solid #dee2e6;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    /* 图例样式增强 */
    legend {
        font-size: 1.1rem;
        font-weight: 600;
        color: #495057;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e9ecef;
        margin-bottom: 1rem;
    }
</style>
<div class="row mb-3">
    <div class="col-md-8">
        <fieldset id="antenna_status">
            <legend>系统状态：</legend>
            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>无状态</th>
                        <th>初始化</th>
                        <th>预搜索</th>
                        <th>跟踪</th>
                        <th>故障</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><li class="statusLight" id="light_none"></li></td>
                        <td><li class="statusLight" id="light_init"></li></td>
                        <td><li class="statusLight" id="light_presearch"></li></td>
                        <td><li class="statusLight" id="light_track"></li></td>
                        <td><li class="statusLight" id="light_fault"></li></td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
    </div>
    <div class="col-md-4">
        <fieldset id="link_status">
            <legend>无线网络状态：</legend>
            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th>断联</th>
                        <th>拨号成功</th>
                        <th>驻留小区</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><li class="statusLight" id="dtu_unlink"></li></td>
                        <td><li class="statusLight" id="dtu_state_dial"></li></td>
                        <td><li class="statusLight" id="dtu_state_normal"></li></td>
                    </tr>
                </tbody>
            </table>
        </fieldset>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <fieldset class="mb-3">
            <legend>MBP状态参数：</legend>
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">基站名称：</span>
                        <input id="bts_name" type="text" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">基站编号：</span>
                        <input id="bts_no" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">基站经度：</span>
                        <input id="bts_longitude" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">基站纬度：</span>
                        <input id="bts_latitude" type="number" class="form-control" readonly>
                    </div>
                </div>
            </div>
            <hr>
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">当前经度：</span>
                        <input id="longitude" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">当前纬度：</span>
                        <input id="latitude" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">理论方位角：</span>
                        <input id="theory_yaw" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">当前方位角：</span>
                        <input id="yaw" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">理论俯仰角：</span>
                        <input id="theory_pitch" type="number" class="form-control" readonly disabled>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">当前俯仰角：</span>
                        <input id="pitch" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">方位限位：</span>
                        <input id="yaw_limit" type="text" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">当前横滚角：</span>
                        <input id="roll" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">温度：</span>
                        <input id="temperature" type="number" class="form-control" readonly>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="input-group mb-3">
                        <span class="input-group-text">湿度：</span>
                        <input id="humidity" type="number" class="form-control" readonly>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>

    <div class="col-md-4">
        <fieldset>
            <legend>驻留小区网络质量：</legend>
            <div class="input-group mb-3">
                <span class="input-group-text">运营商：</span>
                <input id="dtu_plmn" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">制式：</span>
                <input id="dtu_standard" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">小区ID：</span>
                <input id="dtu_cellid" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">PCI：</span>
                <input id="dtu_pci" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">信号接收功率：</span>
                <input id="dtu_rsrp" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">信号强度指示：</span>
                <input id="dtu_rssi" class="form-control" readonly>
            </div>
            <div class="input-group mb-3">
                <span class="input-group-text">信噪比：</span>
                <input id="dtu_sinr" class="form-control" readonly>
            </div>
        </fieldset>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-8">
        <fieldset>
            <legend>设备状态:</legend>
            <div class="d-flex justify-content-between align-items-center">
                <table class="table table-bordered text-center">
                    <thead>
                        <tr>
                            <th>惯导</th>
                            <th>DGPS</th>
                            <th>存储</th>
                            <th>方位电机</th>
                            <th>俯仰电机</th>
                            <th>方位限位</th>
                            <th>俯仰限位</th>
                            <th>RTC</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><li class="statusLight" id="IMUState"></li></td>
                            <td><li class="statusLight" id="DGPSState"></li></td>
                            <td><li class="statusLight" id="storageState"></li></td>
                            <td><li class="statusLight" id="yawMotoState"></li></td>
                            <td><li class="statusLight" id="pitchMotoState"></li></td>
                            <td><li class="statusLight" id="yawLimitState"></li></td>
                            <td><li class="statusLight" id="pitchLimitState"></li></td>
                            <td><li class="statusLight" id="RTCState"></li></td>
                        </tr>
                    </tbody>
                </table>
                <button id="query_devices_status" class="btn btn-info ms-3">查询</button>
            </div>
        </fieldset>
    </div>

    <div class="col-md-4">
        <fieldset class="mb-3">
            <legend>网络速率:</legend>
            <div id="link_speed" class="text-center"><h4>上行：0bps&nbsp;&nbsp;下行：0bps</h4></div>
        </fieldset>
        <fieldset>
            <legend>RSRP:</legend>
            <div class="d-flex justify-content-around align-items-center">
                <div id="rsrp_value" class="text-center"><h1>-? dBm</h1></div>
                <meter id="rsrp_meter" value="0" min="0" low="30" high="70" max="100" optimum="70" style="height: 50px; width: 100px; transform: rotate(270deg);"></meter>
            </div>
        </fieldset>
    </div>
{% endblock %}

{% block page_script %}
<script src="{% static 'js/antenna.js' %}"></script>
{% endblock %}